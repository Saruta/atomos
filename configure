#!/bin/sh

usage()
{
  echo "Configure options:"
  echo " --help: print usage"
  echo " --debug: add debug"
  echo " --userland=test : enable test userland"
  echo " --userland=none : build without userland"
}

check_i386_tools() 
{
  echo "check not implemented, I'm so lazy..."
}


DEBUG=0
USERLAND=
CONFIG_FILE=./include/config.h

for i
do
  case $i in
    "--help")
      usage
      exit 0
      ;;
    "--debug")
      let DEBUG=1
      ;;
    "--userland="*)
      USERLAND="${i##--userland=}"
      if [ $USERLAND != "test" ] &&\
        [ $USERLAND != "none" ]
    then
      echo "Error: only the test userland is available..."
      echo ""
      usage
      exit 1
    fi
    ;;
  *)
    echo "Unknown option -> $i"
    echo ""
    usage 
    exit 1
    ;;
esac
done

check_i386_tools 

#cat <<EOF > ./var.mk
#TARGET_ARCH=$TARGET_ARCH
#TARGET_REPO=$TARGET_ARCH
#EOF

#if [ $TARGET_ARCH == "i386" ]; then
#  echo CFLAGS=-m32 >> var.mk 
#  echo LDFLAGS=-m32 >> var.mk 
#fi

echo "" > $CONFIG_FILE 

cat <<EOF > $CONFIG_FILE
 /*
  * This file was generated by the devil.
  * Please do not edit it directly or you will go to hell
  */

#ifndef _CONFIG_H_
#define _CONFIG_H_

EOF

if [ $USERLAND == "test" ]; then
  echo "# define USERLAND" >> $CONFIG_FILE
  echo "" >> $CONFIG_FILE
fi

if [ $DEBUG -eq 1 ]; then
  echo "# define DEBUG" >> $CONFIG_FILE
  echo "" >> $CONFIG_FILE
fi


echo "#endif /* _CONFIG_H_ */" >> $CONFIG_FILE

echo "done!"
